# Google Maps統合機能

## 概要

このディレクトリには、Google Maps統合機能のサンプル実装が含まれています。

## 実装済み機能

### 基本的な地図表示機能 (5.1)
- **Google Mapsウィジェット**: `google_maps_flutter`パッケージを使用した地図表示
- **地図の初期化**: 東京駅を中心とした初期表示
- **ジェスチャー対応**: 
  - ピンチズーム
  - パン（スクロール）
  - 回転
  - チルト（傾斜）
- **地図コントロール**: コンパス表示、3D建物表示

### 現在地マーカーの表示 (5.2)
- **位置情報許可管理**: 
  - 位置情報サービスの有効性チェック
  - 許可状態の確認と要求
  - 許可拒否時の適切な処理
- **現在地取得**: 高精度位置情報の取得
- **カスタムマーカー**: 現在地を示すブルーマーカー
- **マーカーアニメーション**: 位置更新時のスムーズな移動
- **タップ機能**: 現在地マーカータップで地図中心移動

## ファイル構成

```
lib/screens/map/
├── sample.dart          # Google Mapsサンプル画面
└── README.md           # このファイル
```

## 使用方法

### 画面への遷移
1. ホーム画面から「地図」ボタンをタップ
2. 地図画面で「Google Mapsサンプルを見る」ボタンをタップ

### 機能の使用
- **現在地取得**: 画面初期化時に自動実行、または現在地ボタンをタップ
- **地図操作**: 
  - ピンチでズーム
  - ドラッグでパン
  - 2本指回転で地図回転
- **現在地移動**: 現在地マーカーまたは現在地ボタンをタップ
- **初期位置復帰**: ホームボタンをタップ

## 技術仕様

### 依存関係
- `google_maps_flutter`: Google Maps表示
- `geolocator`: 位置情報取得
- `permission_handler`: 権限管理

### 権限設定
- **Android**: `ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION`
- **iOS**: `NSLocationWhenInUseUsageDescription`

### API設定
- **Android**: `GOOGLE_MAPS_API_KEY`環境変数
- **iOS**: `GMSApiKey`をInfo.plistに設定

## ログ出力

実装では`AppLogger`を使用して以下のログを出力します：

- **情報ログ**: 画面初期化、位置取得成功、地図操作
- **警告ログ**: 位置情報サービス無効、許可拒否
- **エラーログ**: 位置取得失敗、その他のエラー

## エラーハンドリング

### 位置情報関連
- 位置情報サービス無効: ダイアログで設定案内
- 許可拒否: スナックバーでメッセージ表示
- 許可永続拒否: ダイアログで設定画面への誘導
- 位置取得失敗: エラーメッセージと再試行オプション

### UI状態管理
- 位置取得中: ローディングインジケーター表示
- 現在地未取得: ボタンの状態変更
- エラー状態: 適切なメッセージ表示

## 今後の拡張予定

- 投稿ピンの表示
- 地図タイプの切り替え
- リアルタイム位置更新
- カスタムマーカーアイコン
- 地図スタイルのカスタマイズ